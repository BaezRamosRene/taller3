<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Taller ‚Äì Votaci√≥n con filtro + c√°mara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --bg:#f6f6f6; --card:#fff; --text:#111; --muted:#666; --border:#e5e5e5; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .container{ max-width:1000px; margin:0 auto; padding:20px; }
    h1{ margin:0 0 6px; font-size:26px }
    .muted{ color:var(--muted); margin:0 0 18px; font-size:14px }
    .card{ background:#fff; border:1px solid var(--border); border-radius:16px; padding:16px; margin:0 0 18px; box-shadow:0 1px 2px rgba(0,0,0,.03) }
    .grid{ display:grid; gap:10px }
    @media (min-width:640px){ .grid-4{ grid-template-columns:repeat(4,1fr) } .grid-2{ grid-template-columns:repeat(2,1fr) } }
    .option{ border:1px solid var(--border); border-radius:14px; padding:14px; cursor:pointer; text-align:left; background:#fff; transition:.15s }
    .option:hover{ border-color:#d6d6d6 }
    .option[aria-pressed="true"]{ outline:3px solid rgba(0,0,0,.06); box-shadow:0 0 0 2px rgba(0,0,0,.04) inset }
    .swatch{ width:14px; height:14px; border-radius:4px; display:inline-block; border:1px solid rgba(0,0,0,.08); margin-right:8px; vertical-align:middle }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .btn{ border:1px solid var(--border); background:#111; color:#fff; border-radius:12px; padding:10px 14px; font-size:14px; cursor:pointer }
    .btn.secondary{ background:#fff; color:#111 }
    .btn:disabled{ opacity:.5; cursor:not-allowed }
    .small{ font-size:12px; color:var(--muted) }
    .preview{ position:relative; width:100%; aspect-ratio:16/9; background:#f0f0f0; border:1px solid var(--border); border-radius:16px; overflow:hidden }
    .preview img, .preview video{ width:100%; height:100%; object-fit:cover; display:block }
    .overlay{ position:absolute; inset:0; mix-blend-mode:multiply; opacity:.35; pointer-events:none }
    .grad{ position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.10), transparent); pointer-events:none }
    .between{ display:flex; justify-content:space-between; align-items:center }
    .bar{ height:12px; background:#f0f0f0; border:1px solid var(--border); border-radius:999px; overflow:hidden }
    .bar > div{ height:100% }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Encuesta con filtro de foto</h1>
      <p class="muted">Eleg√≠ una opci√≥n, sub√≠ una foto o us√° la c√°mara, aplic√° el filtro y confirm√° tu voto. Luego pod√©s <b>compartir la imagen</b>.</p>
    </header>

    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px">1) Eleg√≠ una opci√≥n</h2>
      <div id="options" class="grid grid-4"></div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px">2) Sub√≠ una foto o us√° la c√°mara</h2>
      <div class="grid grid-2">
        <div>
          <label class="small" for="fileInput">Eleg√≠ imagen (JPG/PNG)</label><br/>
          <input id="fileInput" type="file" accept="image/*" />
          <p class="small">Tip: tambi√©n pod√©s arrastrar una imagen sobre la previsualizaci√≥n.</p>

          <div class="row" style="margin-top:10px">
            <button id="openCamBtn" class="btn">Usar c√°mara</button>
            <button id="snapBtn" class="btn secondary" disabled>Tomar foto</button>
            <button id="closeCamBtn" class="btn secondary" disabled>Apagar c√°mara</button>
          </div>
          <p class="small">La c√°mara necesita HTTPS (GitHub Pages ya lo tiene) y permiso del navegador.</p>
        </div>

        <div>
          <div class="preview" id="preview">
            <video id="camVideo" playsinline autoplay hidden></video>
            <img id="previewImg" alt="Previsualizaci√≥n" hidden />
            <div id="overlay" class="overlay"></div>
            <div class="grad"></div>
          </div>
          <div id="filterInfo" class="small" style="margin-top:6px;"></div>
        </div>
      </div>
    </section>

    <div class="row" style="margin-bottom:18px">
      <button id="confirmBtn" class="btn">Confirmar voto</button>
      <button id="shareBtn" class="btn secondary">Compartir imagen</button>
      <button id="resetBtn" class="btn secondary">Reiniciar</button>
      <span id="totalVotes" class="small">Votos totales: 0</span>
    </div>

    <section class="card">
      <h2 style="margin:0 0 10px;font-size:16px">3) Resultados</h2>
      <div id="results"></div>
      <p class="small" style="margin-top:8px;">Los porcentajes se recalculan al confirmar tu voto.</p>
    </section>

    <footer class="small" style="text-align:center;margin-top:18px">Hecho con üíª y mate.</footer>
  </div>

  <!-- Canvas oculto para componer la imagen con filtro -->
  <canvas id="renderCanvas" style="display:none;"></canvas>

  <!-- Cache-bust con ?v=5 para evitar cach√© vieja -->
  <script src="./taller.js?v=5"></script>
</body>
</html>
